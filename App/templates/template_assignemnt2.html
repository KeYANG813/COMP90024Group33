
<!doctype html>
<html>
<head>
  <meta http-equiv="refresh" content="300">	
  <meta charset="utf-8">
  <title>webAPP</title>
  <script type="text/javascript" src="../static/js/jquery.js"></script>
  <link rel="stylesheet" href="../static/css/comon2.css">
</head>



<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.anychart.com/releases/v8/js/anychart-base.min.js"></script>
<script src="https://cdn.anychart.com/releases/v8/js/anychart-tag-cloud.min.js"></script>

  <!-- <script type="text/javascript" src="../static/js/axios.min.js"></script> -->

<div id="app">
  <!-- 透明度 -->
  <div class="canvas" style="opacity: .8" >
    <!-- <h1 class="padding">Melbourne SA2 compound sentiment analysis</h1> -->
    <iframe frameborder="0" scrolling="no" src="../static/js/nltk.html" style="width: 100%; height: 63%"></iframe>

  </div>
 
  <div class="loading">
    <div class="loadbox"> <img src="../static/picture/loading.gif"> Loading... </div>
  </div>


<script>
	$(window).load(function(){  
             $(".loading").fadeOut()
            })  
			
/****/
$(document).ready(function(){
	var whei=$(window).width()
	$("html").css({fontSize:whei/20})
	$(window).resize(function(){
		var whei=$(window).width()
	 $("html").css({fontSize:whei/20})
});
	});
</script>
<!-- <script type="text/javascript" src="../static/js/echarts.min.js"></script> -->
<script type="text/javascript" src="../static/js/echarts5.min.js"></script>
<script type="text/javascript" src="../static/js/echarts-wordcloud.min.js"></script>
<script type="text/javascript" src="../static/js/vue.min.js"></script>
	<!-- <script language="JavaScript" src="../static/js/js.js"></script> -->
<body>



<div class="head">
  <h1>Tweet Analysis</h1>
  <div class="weather"><span id="showTime"></span></div>
	
	<script>
    var t = null;
    t = setTimeout(time,1000);//開始运行
    function time()
    {
      clearTimeout(t);//清除定时器
      dt = new Date();
      var y=dt.getFullYear();
      var mt=dt.getMonth()+1;
      var day=dt.getDate();
      var h=dt.getHours();//获取时
      var m=dt.getMinutes();//获取分
      var s=dt.getSeconds();//获取秒
      document.getElementById("showTime").innerHTML = "Date: "+y+"/"+mt+"/"+day+"-"+h+":"+m+":"+s;
      t = setTimeout(time,1000); //设定定时器，循环运行     
    } 

  </script>
</div>

<div class="mainbox1"  >
  <ul class="clearfix">
    <li>
      <div class="bar">
        <div class="barbox">
          <ul class="clearfix">
           
            <li class="pulll_left counter">434847</li>
          </ul>
        </div>
        <div class="barbox2">
          <ul class="clearfix">
            <li class="pulll_left">Melbourne Total Tweets (from old data)</li>
          </ul>
        </div>
</li> 
</ul>
</div>



<div class="mainbox4"  >
  <ul class="clearfix">
 

    <li>
      <div class="bar2">
        <div class="barbox3">
          <ul class="clearfix">
          <li class="padding">Melbourne Income Analysis</li>
        </ul>
        </div>
      </div>
      <div class="boxall" style="height: 6.4rem">
        <div class="alltitle">Income over poor and rich suburbs</div>
        <div class="allnav" id="echart6"></div>
        <div class="boxfoot"></div>
      </div>
      <div class="boxfoot">

		  </div>

    </li>

    <li>
      <div class="bar2">
        <div class="barbox3">
          <ul class="clearfix">
          <li class="padding">Melbourne Sentiment Analysis</li>
        </ul>
        </div>
      </div>
      <div class="boxall" style="height:6.4rem">
        <div class="alltitle">Sentiment score over poor and rich suburbs</div>
        <div class="allnav" id="echart4"></div>
        <div class="boxfoot"></div>
      </div>
    </li>

    <li>
      <div class="bar2">
        <div class="barbox3">
          <ul class="clearfix">
          <li class="padding">Melbourne SA2 compound sentiment analysis</li>
        </ul>
        </div>
      </div>

      <div class="boxfoot"></div>
    </li>
    
  </ul>
</div>

<div class="mainbox1"  >
  <ul class="clearfix">
    <li>
  <div class="bar">
    <div class="barbox">
      <ul class="clearfix">
        <li class="pulll_left counter" v-text="totalltweets">{{totalltweets}}</li>
      </ul>
    </div>
    <div class="barbox2">
      <ul class="clearfix">
        <li class="pulll_left">Total Live Tweets</li>
      </ul>
    </div>
  </div>
</li> 
</ul>
</div>

<div class="mainbox5"  >
  <ul class="clearfix">
    <li>
      <div class="map">
        <div class="map4" id="map_1"></div>
      </div>
    </li>


    <li>
      <div class="bar2">
      <div class="barbox3">
        <ul class="clearfix">
        <li class="padding">Language Distribution</li>
      </ul>
      </div>
    </div>
        <div class="boxall" style="height: 5rem">
          <div class="alltitle">Regional Tweets: Language Distribution</div>
          <div class="allnav" id="echart2"></div>
          <div class="boxfoot"></div>
        </div>
     
     
    </li>

    <li>
      <div class="bar2">
        <div class="barbox3">
          <ul class="clearfix">
          <li class="padding">Hashtags Word Cloud</li>
        </ul>
        </div>
      </div>
      <div class="boxall" style="height: 5rem">
        <div class="alltitle">Regional Top hashtags</div>
        <div class="allnav" id="echart5"></div>
        <div class="boxfoot"></div>
      </div>
      <div class="boxfoot">
			
		  </div>

    </li>

</ul>
</div>






<div class="back"></div>
</div>

<script>
  // var city_2018 = {}, city_2019 = {}, city_2020 = {}, city_2021 = {};
  var city = {}
  var lang_data = [];
  var freq_data = [
        [],
        [],
        [],
        [],
        [],
        []
  ];
  var seti_data = [
        [],
        []
  ];
  var income_data = [
        [],
        []
  ];
  var sent_data = [];
  var hashtags_data = [];

  // var year = ["2018","2019", "2020", "2021"];
  //geoCoordMap把所有可能出现的城市加到数组里面
  var geoCoordMap = {
      'adelaide': [138.6007, -34.9285],
      'brisbane': [153.0260, -27.4705],
      "darwin": [130.841782, -12.462827],
      "melbourne": [144.9631, -37.8136],
      "sydney": [151.2093, -33.8688],
  };

  
  var keys = Object.keys( geoCoordMap );
  // console.log(keys)

  var vue = new Vue({
    el:'#app',
    data:{
      totalltweets:0,
      freq_tweets:0,
      city_lang:0,
      city_sentiment:0,
      city_tweets:0,
      // city_time_dis:0,
      city_hashtags:0,
      mel_income:0,
    },
    mounted (){
     this.get_total_tweets()
     this.get_city_tweets()
     this.get_city_lang_distribution()
     this.get_city_sentiment()
     this.get_city_freq_tweet()
     this.get_city_topwords()
     this.get_city_income()
    },
    
    methods:{

      get_total_tweets:function(){
        var that =this;

        axios.get("/totaltweet")
                .then(function (response) {
                  console.log(response);
                  that.totalltweets=response.data['total_tweets'];
                  console.log(response.data['total_tweets']);
                })
                .catch(function (error) {
                  console.log(error);
                });

      },
     
      get_city_lang_distribution:function(){
        var that =this;

        axios.get("/senario1")
                .then(function (response) {
                  console.log(response);
                  that.city_lang=response.data;
                  for (loc in geoCoordMap){
                    window[loc+'_lang'] = []
                    for (var lang in that.city_lang[loc]){
                        window[loc+'_lang'].push({"name": lang, "value": that.city_lang[loc][lang]})}                      
                    lang_data.push(window[loc+'_lang'])}
                  console.log(lang_data)
                })
                .catch(function (error) {
                  console.log(error);
                });

      },

      get_city_freq_tweet(){
        var that =this;
        axios.get("/senario2")
                .then(function (response) {
                  console.log(response);
                  that.freq_tweets=response.data;
                  for (var i = 0; i < freq_data.length; i++){
                    if (i == 0){
                      freq_data[i].push("Hot Topic")
                      freq_data[i].push("shopping")
                      freq_data[i].push("luxury")
                      freq_data[i].push("travel")
                    } else {
                      freq_data[i].push(keys[i-1])
                      freq_data[i].push(that.freq_tweets[keys[i-1]]["shopping"])
                      freq_data[i].push(that.freq_tweets[keys[i-1]]["luxury"])
                      freq_data[i].push(that.freq_tweets[keys[i-1]]["travel"])
                    }
                  }
                  console.log(freq_data)
                  
                })
                .catch(function (error) {
                  console.log(error);
                });

      },
      get_city_sentiment(){
        var that =this;
        axios.get("/senario3setiment")
                .then(function (response) {
                  console.log(response);
                  that.city_sentiment=response.data;
                  for (var i = 0; i < seti_data.length; i++){
                    if (i == 0){
                      for (loc in geoCoordMap){
                        seti_data[i].push(loc)
                      }
                    } else {
                      for (loc in geoCoordMap){
                        seti_data[i].push(that.city_sentiment[loc])
                      }
                    }
                  }
                  console.log(seti_data)
                  
                })
                .catch(function (error) {
                  console.log(error);
                });


      },
      get_city_tweets:function(){
        var that =this;
        axios.get("/tweetpercity")
                .then(function (response) {
                  // console.log(response);
                  that.city_tweets=response.data;
                  // console.log(that.city_tweets);
                  // city['adelaide'] = that.city_tweets.adelaide
                  // city['brisbane'] =  that.city_tweets.brisbane
                  // city["darwin"] = that.city_tweets.darwin
                  // city["melbourne"] = that.city_tweets.melbourne
                  // city["sydney"] = that.city_tweets.sydney
                  city['adelaide'] = that.city_tweets.db_adelaide['2022']
                  city['brisbane'] =  that.city_tweets.db_brisbane['2022']
                  city["darwin"] = that.city_tweets.db_darwin['2022']
                  city["melbourne"] = that.city_tweets.db_melbourne['2022']
                  city["sydney"] = that.city_tweets.db_sydney['2022']
                  console.log(city);
                })
                .catch(function (error) {
                  console.log(error);
                });

      },
      get_city_topwords(){
        var that =this;

        axios.get("/senario3")
                .then(function (response) {
                  //console.log(response);
                  that.city_hashtags=response.data;
                  hashtags_data = JSON.parse(JSON.stringify(that.city_hashtags))
                  console.log(hashtags_data);
                })
                .catch(function (error) {
                  console.log(error.response.data);
                });

      },

      // get_city_income(){
      //   var that =this;
      //   axios.get("/senario2income")
      //           .then(function (response) {
      //             console.log(response);
      //             that.mel_income=response.data;
      //             for (var i = 0; i < income_data.length; i++){
      //               if (i == 0){
      //                 for (loc in that.mel_income){
      //                   income_data[i].push(loc)
      //                 }
      //               } else {
      //                 for (loc in that.mel_income){
      //                   income_data[i].push(that.mel_income[loc])
      //                 }
      //               }
      //             }
      //             console.log(income_data)
                  
      //           })
      //           .catch(function (error) {
      //             console.log(error);
      //           });
      // },


    }

    

  });

</script>

<script type="text/javascript" src="../static/js/mapData.js"></script>
<script type="text/javascript" src="../static/js/australia.js"></script>
<script type="text/javascript" src="../static/js/area_echarts_test.js"></script>
</body>
</html>
